


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">

		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>







      <script type="text/javascript" src="_static/js/jquery.min.js"></script>
	  <script type="text/javascript" src="_static/js/gtm.js"></script>
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="_static/js/common-ui-all.min.js"></script>
    <script type="text/javascript" src="_static/js/header-footer.min.js"></script>
    <script type="text/javascript" src="_static/js/jquery-ui.min.js"></script>
    <script type="text/javascript" src="_static/js/CoveoJsSearch.Lazy.min.js"></script>
    <script type="text/javascript" src="_static/js/linkid.js"></script>
    <script type="text/javascript" src="_static/js/Searchbox.min.js"></script>


      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>

    <script type="text/javascript" src="_static/js/theme.js"></script>




  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="class xlnx::qdma_interface" href="qdma_win_export_apis.html" />
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="header parbase aem-GridColumn aem-GridColumn--default--12">
								<noindex>
									<header data-component="header">
										<nav class="navbar navbar-default aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid main-nav">
													<div class="row">
														<div class="col-xs-12">
															<div class="logo-column">
																<div class="logo">
																	<a href="https://www.xilinx.com/">
																	<img src="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/all/resources/imgs/header/xilinx-header-logo.svg" title="Xilinx Inc"/>
																	</a>
																</div>
															</div>
															<div class="navbar-column">
																<div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
																	<div class="mobile-search-container">
																		<div id="headerSearchBox" class="headerSearch"
																			data-component="header-search"
																			data-redirect-if-empty="false"
																			data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																			data-coveo-organization-id="xilinxcomprode2rjoqok">
																			<div class='coveo-search-section'>
																				<div class="CoveoAnalytics" data-search-hub="Site"></div>
																				<ul class="dropdown-menu options">
																					<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																						<a href="#">
																						All</a>
																					</li>
																					<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com//products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Silicon Devices</a>
																					</li>
																					<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com//products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Boards and Kits</a>
																					</li>
																					<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com//products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Intellectual Property</a>
																					</li>
																					<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																						<a href="#">
																						Support</a>
																						<ul>
																							<li data-label="Documentation" data-action-link="https://www.xilinx.com//support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																								<a href="#">
																								Documentation</a>
																							</li>
																							<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com//support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																								<a href="#">
																								Knowledge Base</a>
																							</li>
																							<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																								<a href="#">
																								Community Forums</a>
																							</li>
																						</ul>
																					</li>
																					<li data-label="Partners" data-action-link="https://www.xilinx.com//alliance/member-keyword-search.html" data-search-hub="Partner">
																						<a href="#">
																						Partners</a>
																					</li>
																					<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																						<a href="#">
																						Videos</a>
																					</li>
																					<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																						<a href="#">
																						Press</a>
																					</li>
																				</ul>
																				<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																				<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																			</div>
																		</div>
																	</div>
																	<ul class="nav navbar-nav nav-justified">
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/applications.html">
																			Applications</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/products/silicon-devices.html">
																			Products</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://developer.xilinx.com/">
																			Developers</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/support.html">
																			Support</a>
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/about/company-overview.html">
																			About</a>
																		</li>
																	</ul>
																</div>
															</div>
															<script type="text/javascript" src="_static/js/gtm.js"></script>
															<!--<div class="mini-nav">
																<button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
																<span></span>
																<span></span>
																<span></span>
																<span></span>
																</button>
																<ul class="list-inline">
																	<li class="dropdown user-menu">
																		<button data-toggle="dropdown">
																		<span class="sr-only">Account</span>
																		<span class="fas fa-user"></span>
																		</button>
																		<ul class="dropdown-menu">
																			<li>
																				<a href="https://www.xilinx.com/myprofile/subscriptions.html">
																				My Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/registration/create-account.html">
																				Create Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/bin/protected/en/signout">
																				Sign Out</a>
																			</li>
																		</ul>
																	</li>
																	<li class="hidden-xs">
																		<button data-function="search-toggle">
																		<span class="sr-only">Search</span>
																		<span class="far fa-search"></span>
																		</button>
																	</li>
																</ul>
															</div>
															-->
															<div class="search-container">
																<div id="headerSearchBox" class="headerSearch"
																	data-component="header-search"
																	data-redirect-if-empty="false"
																	data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																	data-coveo-organization-id="xilinxcomprode2rjoqok">
																	<div class='coveo-search-section'>
																		<div class="CoveoAnalytics" data-search-hub="Site"></div>
																		<ul class="dropdown-menu options">
																			<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																				<a href="#">
																				All</a>
																			</li>
																			<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com/products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Silicon Devices</a>
																			</li>
																			<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com/products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Boards and Kits</a>
																			</li>
																			<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com/products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Intellectual Property</a>
																			</li>
																			<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																				<a href="#">
																				Support</a>
																				<ul>
																					<li data-label="Documentation" data-action-link="https://www.xilinx.com/support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																						<a href="#">
																						Documentation</a>
																					</li>
																					<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com/support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																						<a href="#">
																						Knowledge Base</a>
																					</li>
																					<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																						<a href="#">
																						Community Forums</a>
																					</li>
																				</ul>
																			</li>
																			<li data-label="Partners" data-action-link="https://www.xilinx.com/alliance/member-keyword-search.html" data-search-hub="Partner">
																				<a href="#">
																				Partners</a>
																			</li>
																			<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																				<a href="#">
																				Videos</a>
																			</li>
																			<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																				<a href="#">
																				Press</a>
																			</li>
																		</ul>
																		<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																		<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																	</div>
																</div>
																<button data-function="search-toggle">
																<span class="sr-only">Search</span>
																<span class="far fa-times"></span>
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</nav>
									</header>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">

  <div class="wy-grid-for-nav">

    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >



            <a href="index.html" class="icon icon-home" alt="Documentation Home"> QDMA Windows Driver



          </a>




              <div class="version">
                2020.2
              </div>




<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>


        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">






              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="features.html">QDMA Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="system-requirements.html">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Building the QDMA driver software</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-app.html">User Applications</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="devguide.html">Developers Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="qdma_exports.html">QDMA Windows Driver Exported APIs</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">QDMA Windows Driver UseCases</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#axi4-memory-mapped-and-axi-stream-with-completion">AXI4 Memory Mapped And AXI-Stream with Completion</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mm-h2c-host-to-card">MM H2C(Host-to-Card)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mm-c2h-card-to-host">MM C2H(Card-to-Host)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#st-h2c-host-to-card">ST H2C(Host-to-Card)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#st-c2h-card-to-host">ST C2H(Card-to-Host)</a></li>
</ul>
</li>
</ul>
</li>
</ul>


			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="_sources/qdma_usecases.rst.txt"
						rel="nofollow">Show Source</a></li>
				</ul>

        </div>

      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">


      <nav class="wy-nav-top" aria-label="top navigation">

          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">QDMA Windows Driver</a>

      </nav>


      <div class="wy-nav-content">

        <div class="rst-content">

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">

      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>

          <li><a href="devguide.html">Developers Guide</a> &raquo;</li>

      <li>QDMA Windows Driver UseCases</li>


      <li class="wy-breadcrumbs-aside">


            <a href="_sources/qdma_usecases.rst.txt" rel="nofollow"> View page source</a>


      </li>

  </ul>


  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">

  <div class="section" id="qdma-windows-driver-usecases">
<h1>QDMA Windows Driver UseCases<a class="headerlink" href="#qdma-windows-driver-usecases" title="Permalink to this headline">¶</a></h1>
<p>QDMA IP is released with five example designs in the Vivado® Design Suite. They are</p>
<ol class="arabic simple">
<li><p>AXI4 Memory Mapped And AXI-Stream with Completion</p></li>
<li><p>AXI Memory Mapped</p></li>
<li><p>AXI Memory Mapped with Completion</p></li>
<li><p>AXI Stream with Completion</p></li>
<li><p>AXI Stream Loopback</p></li>
<li><p>Descriptor Bypass In/Out Loopback</p></li>
</ol>
<p><strong>Note</strong>: AXI Memory Mapped with Completion is not supported.</p>
<p>Refer to <a class="reference external" href="https://www.xilinx.com/support/documentation/ip_documentation/qdma/v3_0/pg302-qdma.pdf">QDMA_Product_Guide</a> for more details on these example designs.</p>
<p>The driver functionality remains same for all the example designs.
For <code class="docutils literal notranslate"><span class="pre">Descriptor</span> <span class="pre">Bypass</span> <span class="pre">In/Out</span> <span class="pre">Loopback</span></code> example design, application has to enable the bypass mode in driver.</p>
<p>All the flows described below are with respect to QDMA internal mode of operation.
Also, the changes required in driver for bypass mode of operation are specified.</p>
<div class="section" id="axi4-memory-mapped-and-axi-stream-with-completion">
<h2>AXI4 Memory Mapped And AXI-Stream with Completion<a class="headerlink" href="#axi4-memory-mapped-and-axi-stream-with-completion" title="Permalink to this headline">¶</a></h2>
<p>This is the default example design used to test the MM and ST functionality using QDMA driver. This example design provides blocks to interface with the AXI4 Memory Mapped and AXI4-Stream interfaces. This example design covers most of the functionality provided by QDMA.</p>
<p>Refer to QDMA Product Guide for more details on the example design and its registers.</p>
<p>Below sections describes C2H and H2C data flow for ST and MM mode required in all the example designs.</p>
</div>
<div class="section" id="mm-h2c-host-to-card">
<h2>MM H2C(Host-to-Card)<a class="headerlink" href="#mm-h2c-host-to-card" title="Permalink to this headline">¶</a></h2>
<p>This Example Design provides BRAM with AXI-MM interface to achieve the MM H2C functionality.
The driver comes with <code class="docutils literal notranslate"><span class="pre">dma-ctl</span></code> and <code class="docutils literal notranslate"><span class="pre">dma-rw</span></code> applications which helps to realize the MM H2C functionality. QDMA driver takes care of HW updates.</p>
<p>The complete flow between the Host components and HW components is depicted in below sequence.</p>
<ul class="simple">
<li><p>Application needs to configure the queue to start in MM mode</p></li>
<li><p>dma-rw command takes a file containing the contents to be transmitted to FPGA memory as an input</p></li>
<li><p>Pass the buffer to be transferred as an input to <code class="docutils literal notranslate"><span class="pre">dma-rw</span></code> application which in turn passes it to the QDMA Driver</p></li>
<li><p>QDMA driver programs the descriptors with buffer base address and updates the H2C ring PIDX</p></li>
<li><p>Upon H2C ring PIDX update, DMA engine fetches the descriptors and passes them to H2C MM Engine for processing</p></li>
<li><p>H2C MM Engine reads the buffer contents from the Host and writes to the BRAM</p></li>
<li><p>Upon transfer completion, DMA Engine updates the CIDX in H2C ring completion status and generates interrupt if required. In poll mode, QDMA driver polls on CIDX update.</p></li>
<li><p>QDMA driver processes the completion status and sends the response back to the application</p></li>
</ul>
<p>For MM (H2C and C2H) bypass mode, application needs to enable the bypass mode on the required queues.
Application can enable C2H/H2C bypass mode while starting the queue using <code class="docutils literal notranslate"><span class="pre">dma-ctl</span></code> application by specifying <code class="docutils literal notranslate"><span class="pre">desc_bypass_en</span></code> flag .</p>
<p>The MM descriptor format used by the example design is defined in QDMA Driver code base at <code class="docutils literal notranslate"><span class="pre">sys/libqdma/include/qdma_reg_ext.h</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct mm_descriptor {
    UINT64 addr;

    UINT64 length : 28;
    UINT64 valid : 1;
    UINT64 sop : 1;
    UINT64 eop : 1;
    UINT64 reserved_0 : 33;

    UINT64 dest_addr;

    UINT64 reserved_1;
};
static_assert(sizeof(mm_descriptor) == (32 * sizeof(UINT8)), &quot;mm_descriptor must be 32 bytes wide!&quot;);
</pre></div>
</div>
<p>Update this structure if any changes required in the descriptor format for bypass mode.
Accordingly, update the data flow functionality in <code class="docutils literal notranslate"><span class="pre">qdma_enqueue_mm_request()</span></code> functions in <code class="docutils literal notranslate"><span class="pre">sys/libqdma/source/qdma.cpp</span></code>.</p>
</div>
<div class="section" id="mm-c2h-card-to-host">
<h2>MM C2H(Card-to-Host)<a class="headerlink" href="#mm-c2h-card-to-host" title="Permalink to this headline">¶</a></h2>
<p>This Example Design provides BRAM with AXI-MM interface to achieve the MM C2H functionality.
The current driver with <code class="docutils literal notranslate"><span class="pre">dma-ctl</span></code> tool and dma-rw application helps achieve the MM C2H functionality and QDMA driver takes care of HW updates.</p>
<p>The complete flow between the Host components and HW components is depicted in below sequence.</p>
<ul class="simple">
<li><p>User needs to start the queue in MM mode</p></li>
<li><p>Pass the buffer to copy the data as an input to <code class="docutils literal notranslate"><span class="pre">dma-rw</span></code> application which inturn passes it to the QDMA Driver</p></li>
<li><p>QDMA driver programs the required descriptors based on the length of the required buffer and programs the descriptors with buffer base address and updates the C2H ring PIDX</p></li>
<li><p>Upon C2H ring PIDX update, DMA engine fetches the descriptors and passes them to C2H MM Engine for processing</p></li>
<li><p>C2H MM Engine reads the BRAM contents writes to the Host buffers</p></li>
<li><p>Upon transfer completion, DMA Engine updates the PIDX in C2H ring completion status and generates interrupt if required. In poll mode, QDMA driver polls on PIDX update.</p></li>
<li><p>QDMA driver processes the completion status and sends the response back to the application with the data received.</p></li>
</ul>
</div>
<div class="section" id="st-h2c-host-to-card">
<h2>ST H2C(Host-to-Card)<a class="headerlink" href="#st-h2c-host-to-card" title="Permalink to this headline">¶</a></h2>
<p>In ST H2C, data is moved from Host to Device through H2C stream engine.The H2C stream engine moves data from the Host to the H2C Stream interface. The engine is
responsible for breaking up DMA reads to MRRS size, guaranteeing the space for completions,
and also makes sure completions are reordered to ensure H2C stream data is delivered to user
logic in-order.The engine has sufficient buffering for up to 256 DMA reads and up to 32 KB of data. DMA
fetches the data and aligns to the first byte to transfer on the AXI4 interface side. This allows
every descriptor to have random offset and random length. The total length of all descriptors put
to gather must be less than 64 KB.</p>
<p>There is no dependency on user logic for this use case.</p>
<p>The complete flow between the Host components and HW components is depicted in below sequence.</p>
<ul class="simple">
<li><p>User needs to start the queue in ST mode</p></li>
<li><p>Pass the  buffer to be transferred as an input to <code class="docutils literal notranslate"><span class="pre">dma-rw</span></code> application which in turn passes it to the QDMA Driver</p></li>
<li><p>QDMA driver programs the descriptors with buffer base address and updates the H2C ring PIDX</p></li>
<li><p>Upon H2C ring PIDX update, DMA engine fetches the descriptors and passes them to H2C Stream Engine for processing</p></li>
<li><p>H2C Stream Engine reads the buffer contents from the Host buffers the data</p></li>
<li><p>Upon transfer completion, DMA Engine updates the CIDX in H2C ring completion status and generates interrupt if required. In poll mode, QDMA driver polls on CIDX update.</p></li>
<li><p>QDMA driver processes the completion status and sends the response back to the application</p></li>
</ul>
<p>For ST H2C bypass mode, application needs to enable the bypass mode on the required queues.
Application can enable H2C bypass mode while starting the queue using <code class="docutils literal notranslate"><span class="pre">dma-ctl</span></code> application by specifying <code class="docutils literal notranslate"><span class="pre">desc_bypass_en</span></code> flag.</p>
<p>The ST H2C descriptor format used by the example design is defined in QDMA Driver code base at <code class="docutils literal notranslate"><span class="pre">sys/libqdma/include/qdma_reg_ext.h</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct h2c_descriptor {
    UINT16 cdh_flags;     /**&lt; Dont care bits */
    UINT16 pld_len;       /**&lt; Packet length in bytes */
    UINT16 length;
    UINT16 sop : 1;
    UINT16 eop : 1;
    UINT16 reserved : 14;
    UINT64 addr;
};
static_assert(sizeof(h2c_descriptor) == (16 * sizeof(UINT8)), &quot;h2c_descriptor must be 16 bytes wide!&quot;);
</pre></div>
</div>
<p>Update this structure if any changes required in the descriptor format for bypass mode.
Accordingly, update the data flow functionality in <code class="docutils literal notranslate"><span class="pre">qdma_enqueue_st_tx_request()</span></code> functions in <code class="docutils literal notranslate"><span class="pre">sys/libqdma/source/qdma.cpp</span></code>.</p>
</div>
<div class="section" id="st-c2h-card-to-host">
<h2>ST C2H(Card-to-Host)<a class="headerlink" href="#st-c2h-card-to-host" title="Permalink to this headline">¶</a></h2>
<p>In ST C2H, data is moved from DMA Device to Host through C2H Stream Engine.</p>
<p>The C2H streaming engine is responsible for receiving data from the user logic and writing to the
Host memory address provided by the C2H descriptor for a given Queue.
The C2H Stream Engine, DMA writes the stream packets to the Host memory into the descriptors
provided by the Host QDMA driver through the C2H descriptor queue.</p>
<p>The C2H engine has two major blocks to accomplish C2H streaming DMA,</p>
<ul class="simple">
<li><p>Descriptor Prefetch Cache (PFCH)</p></li>
<li><p>C2H-ST DMA Write Engine</p></li>
</ul>
<p>QDMA Driver needs to program the prefetch context along with the per queue context to achieve the ST C2H functionality.</p>
<p>The Prefetch Engine is responsible for calculating the number of descriptors needed for the DMA
that is writing the packet. The buffer size is fixed per queue basis. For internal and cached bypass
mode, the prefetch module can fetch up to 512 descriptors for a maximum of 64 different
queues at any given time.</p>
<p>The Completion Engine is used to write to the Completion queues. When used with a DMA engine, the
completion is used by the driver to determine how many bytes of data were transferred with
every packet. This allows the driver to reclaim the descriptors.</p>
<p>PFCH cache has three main modes, on a per queue basis, called</p>
<ul class="simple">
<li><p>Simple Bypass Mode</p></li>
<li><p>Internal Cache Mode</p></li>
<li><p>Cached Bypass Mode</p></li>
</ul>
<p>While starting the queue in ST C2H mode using <code class="docutils literal notranslate"><span class="pre">dma-ctl</span></code> tool, user has the configuration options to configure
the queue in any of these 3 modes.</p>
<p>The current ST C2H functionality implemented in QDMA driver is tightly coupled with the Example Design.
Though the completion entry descriptor as per PG is fully configurable, this Example Design
mandates to have the the color, error and desc_used bits in the first nibble.
The completion entry format is defined in QDMA Driver code base <code class="docutils literal notranslate"><span class="pre">sys/libqdma/include/qdma_reg_ext.h</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>struct c2h_wb_header_8B {
    /** @data_frmt : 0 indicates valid length field is present */
    UINT64 data_frmt      : 1;
    /** @color : Indicates the validity of the entry */
    UINT64 color          : 1;
    /** @desc_error : Indicates the error status */
    UINT64 desc_error     : 1;
    /** @desc_used : Indicates whether data descriptor used */
    UINT64 desc_used      : 1;
    /** @length : Length of the completion entry */
    UINT64 length         : 16;
    /** @user_rsv : Reserved */
    UINT64 user_rsv       : 4;
    /** @user_defined_0 : User Defined Data (UDD) */
    UINT64 user_defined_0 : 40;
};
static_assert(sizeof(c2h_wb_header_8B) == (8 * sizeof(UINT8)), &quot;c2h_wb_header_8B must be 8 bytes wide!&quot;);

struct c2h_wb_header_16B : c2h_wb_header_8B {
    /** @user_defined_1 : User Defined Data (UDD) for 16B completion size */
    UINT64 user_defined_1;
};
static_assert(sizeof(c2h_wb_header_16B) == (16 * sizeof(UINT8)), &quot;c2h_wb_header_16B must be 16 bytes wide!&quot;);

struct c2h_wb_header_32B : c2h_wb_header_16B {
    /** @user_defined_2 : User Defined Data (UDD) for 32B completion size */
    UINT64 user_defined_2[2];
};
static_assert(sizeof(c2h_wb_header_32B) == (32 * sizeof(UINT8)), &quot;c2h_wb_header_32B must be 32 bytes wide!&quot;);

struct c2h_wb_header_64B : c2h_wb_header_32B {
    /** @user_defined_3 : User Defined Data (UDD) for 64B completion size */
    UINT64 user_defined_3[4];
};
static_assert(sizeof(c2h_wb_header_64B) == (64 * sizeof(UINT8)), &quot;c2h_wb_header_64B must be 64 bytes wide!&quot;);
</pre></div>
</div>
<p>Completion entry is processed in <code class="docutils literal notranslate"><span class="pre">st_service_c2h_queue()</span></code> function which is part of <code class="docutils literal notranslate"><span class="pre">sys/libqdma/source/qdma.cpp</span></code>.
If a different example design is opted, the QDMA driver code shall be updated to suit to the new example design in above mentioned files.</p>
<p>The ST C2H descriptor format described above shall be changed as per example design requirements.</p>
<p>Update this structure if any changes required in the descriptor format for bypass mode.</p>
<p>Accordingly, update the data flow functionality in <code class="docutils literal notranslate"><span class="pre">st_service_c2h_queue()</span></code> function in <code class="docutils literal notranslate"><span class="pre">sys/libqdma/source/qdma.cpp</span></code>.</p>
</div>
</div>


           </div>

          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->

</footer>

        </div>
      </div>


	  <!-- Sphinx Page Footer block -->

    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">


        <a href="qdma_win_export_apis.html" class="btn btn-neutral float-left" title="class xlnx::qdma_interface" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>

    </div>


  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on December 21, 2020.
      </span>

    </p>
  </div>
      </div>
    </section>




  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>








  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
														<div class="col-md-pull-6 col-lg-pull-6 col-md-6 col-lg-6">
															<span class="copyright">

                                  &copy; 2020, Xilinx, Inc
                              </span>
															<ul class="list-inline sub-menu">
																<li>
																	<a href="https://www.xilinx.com/about/privacy-policy.html">Privacy</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/legal.html">Legal</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/contact.html">Contact</a>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="quicklinks parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<noindex>
						<span class="quickLinks">
							<ul>
								<li>
									<a href="#top" class="btn backToTop">
									<span class="fas fa-angle-up" aria-hidden="true"></span>
									</a>
								</li>
							</ul>
						</span>
					</noindex>
				</div>
			</div>
		</div>
		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}

			underscoreSetup();
		</script>
	</body>
</html>