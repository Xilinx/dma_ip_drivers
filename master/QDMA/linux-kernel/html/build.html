


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

  
  
  
  

  
      <script type="text/javascript" src="_static/js/jquery.min.js"></script>	
	  <script type="text/javascript" src="_static/js/gtm.js"></script>
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="_static/js/common-ui-all.min.js"></script>		
    <script type="text/javascript" src="_static/js/header-footer.min.js"></script>	
    <script type="text/javascript" src="_static/js/jquery-ui.min.js"></script>	
    <script type="text/javascript" src="_static/js/CoveoJsSearch.Lazy.min.js"></script>	
    <script type="text/javascript" src="_static/js/linkid.js"></script>		
    <script type="text/javascript" src="_static/js/Searchbox.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'2022.1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="User Guide" href="userguide.html" />
    <link rel="prev" title="System Requirements" href="system-requirements.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="header parbase aem-GridColumn aem-GridColumn--default--12">
								<noindex>
									<header data-component="header">
										<nav class="navbar navbar-default aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid main-nav">
													<div class="row">
														<div class="col-xs-12">
															<div class="logo-column">
																<div class="logo">
																	<a href="https://www.xilinx.com/">
																	<img src="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/all/resources/imgs/header/xilinx-header-logo.svg" title="Xilinx Inc"/>
																	</a>
																</div>
															</div>
															<div class="navbar-column">
																<div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
																	<div class="mobile-search-container">
																		<div id="headerSearchBox" class="headerSearch"
																			data-component="header-search" 
																			data-redirect-if-empty="false"
																			data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																			data-coveo-organization-id="xilinxcomprode2rjoqok">
																			<div class='coveo-search-section'>
																				<div class="CoveoAnalytics" data-search-hub="Site"></div>
																				<ul class="dropdown-menu options">
																					<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																						<a href="#">
																						All</a>
																					</li>
																					<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com//products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Silicon Devices</a>
																					</li>
																					<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com//products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Boards and Kits</a>
																					</li>
																					<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com//products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Intellectual Property</a>
																					</li>
																					<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																						<a href="#">
																						Support</a>
																						<ul>
																							<li data-label="Documentation" data-action-link="https://www.xilinx.com//support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																								<a href="#">
																								Documentation</a>
																							</li>
																							<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com//support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																								<a href="#">
																								Knowledge Base</a>
																							</li>
																							<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																								<a href="#">
																								Community Forums</a>
																							</li>
																						</ul>
																					</li>
																					<li data-label="Partners" data-action-link="https://www.xilinx.com//alliance/member-keyword-search.html" data-search-hub="Partner">
																						<a href="#">
																						Partners</a>
																					</li>
																					<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																						<a href="#">
																						Videos</a>
																					</li>
																					<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																						<a href="#">
																						Press</a>
																					</li>
																				</ul>
																				<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																				<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																			</div>
																		</div>
																	</div>
																	<ul class="nav navbar-nav nav-justified">
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/applications.html">
																			Applications</a> 
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/products/silicon-devices.html">
																			Products</a> 
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://developer.xilinx.com/">
																			Developers</a> 
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/support.html">
																			Support</a> 
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/about/company-overview.html">
																			About</a> 
																		</li>
																	</ul>
																</div>
															</div>
															<script type="text/javascript" src="_static/js/gtm.js"></script>
															<!--<div class="mini-nav">
																<button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
																<span></span>
																<span></span>
																<span></span>
																<span></span>
																</button>
																<ul class="list-inline">
																	<li class="dropdown user-menu">
																		<button data-toggle="dropdown">
																		<span class="sr-only">Account</span>
																		<span class="fas fa-user"></span>
																		</button>
																		<ul class="dropdown-menu">
																			<li>
																				<a href="https://www.xilinx.com/myprofile/subscriptions.html">
																				My Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/registration/create-account.html">
																				Create Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/bin/protected/en/signout">
																				Sign Out</a>
																			</li>
																		</ul>
																	</li>
																	<li class="hidden-xs">
																		<button data-function="search-toggle">
																		<span class="sr-only">Search</span>
																		<span class="far fa-search"></span>
																		</button>
																	</li>
																</ul>
															</div>
															-->
															<div class="search-container">
																<div id="headerSearchBox" class="headerSearch"
																	data-component="header-search" 
																	data-redirect-if-empty="false"
																	data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																	data-coveo-organization-id="xilinxcomprode2rjoqok">
																	<div class='coveo-search-section'>
																		<div class="CoveoAnalytics" data-search-hub="Site"></div>
																		<ul class="dropdown-menu options">
																			<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																				<a href="#">
																				All</a>
																			</li>
																			<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com/products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Silicon Devices</a>
																			</li>
																			<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com/products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Boards and Kits</a>
																			</li>
																			<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com/products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Intellectual Property</a>
																			</li>
																			<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																				<a href="#">
																				Support</a>
																				<ul>
																					<li data-label="Documentation" data-action-link="https://www.xilinx.com/support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																						<a href="#">
																						Documentation</a>
																					</li>
																					<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com/support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																						<a href="#">
																						Knowledge Base</a>
																					</li>
																					<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																						<a href="#">
																						Community Forums</a>
																					</li>
																				</ul>
																			</li>
																			<li data-label="Partners" data-action-link="https://www.xilinx.com/alliance/member-keyword-search.html" data-search-hub="Partner">
																				<a href="#">
																				Partners</a>
																			</li>
																			<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																				<a href="#">
																				Videos</a>
																			</li>
																			<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																				<a href="#">
																				Press</a>
																			</li>
																		</ul>
																		<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																		<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																	</div>
																</div>
																<button data-function="search-toggle">
																<span class="sr-only">Search</span>
																<span class="far fa-times"></span>
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</nav>
									</header>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> QDMA Linux Driver
          

          
          </a>

          
            
            
              <div class="version">
                2022.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="features.html">QDMA Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="system-requirements.html">System Requirements</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Building and Installing Software Stack</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#updating-the-pcie-device-id">Updating the PCIe device ID</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-the-qdma-driver-software">Building the QDMA Driver Software</a></li>
<li class="toctree-l2"><a class="reference internal" href="#loading-the-qdma-driver-module">Loading the QDMA Driver Module</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#mode">1. <strong>Mode</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#master-pf">2. <strong>Master PF</strong></a></li>
<li class="toctree-l3"><a class="reference internal" href="#dynamic-config-bar">3. <strong>Dynamic Config Bar</strong></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="userguide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-app.html">User Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="devguide.html">Developers Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="performance.html">QDMA Performance</a></li>
</ul>

            
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="_sources/build.rst.txt"
						rel="nofollow">Show Source</a></li>						
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">QDMA Linux Driver</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Building and Installing Software Stack</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/build.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="building-and-installing-software-stack">
<h1>Building and Installing Software Stack<a class="headerlink" href="#building-and-installing-software-stack" title="Permalink to this headline">¶</a></h1>
<p>For building the Linux QDMA Driver, make sure the <a class="reference internal" href="system-requirements.html#sys-req"><span class="std std-ref">System Requirements</span></a> are satisfied.</p>
<div class="section" id="updating-the-pcie-device-id">
<h2>Updating the PCIe device ID<a class="headerlink" href="#updating-the-pcie-device-id" title="Permalink to this headline">¶</a></h2>
<p>During the PCIe DMA IP customization in Vivado you can specify a PCIe Device ID.
This Device ID must be recognized by the driver in order to properly identify the PCIe QDMA device.
The current driver is designed to recognize the default PCIe Device IDs that get generated with the PCIe example design.
If the PCIe Device ID is modified during IP customization, one needs to modify QDMA driver to recognize this new ID.</p>
<p>User can also remove PCIe Device IDs that are not be used in their solution.</p>
<p>To modify the PCIe Device ID in the driver, open the <code class="docutils literal"><span class="pre">driver/src/pci_ids.h</span></code> file from the driver source and search for the <code class="docutils literal"><span class="pre">pci_device_id</span></code> struct.
This struct defines the PCIe Device IDs that are recognized by the driver in the following format:</p>
<p>{PCI_DEVICE (0x10ee, 0x9034),},</p>
<p>Add, remove, or modify the PCIe Device IDs in this struct.
The PCIe DMA driver will only recognize device IDs identified in this struct as PCIe QDMA devices.
Once modified, the driver must be un-installed and recompiled.</p>
</div>
<div class="section" id="building-the-qdma-driver-software">
<h2>Building the QDMA Driver Software<a class="headerlink" href="#building-the-qdma-driver-software" title="Permalink to this headline">¶</a></h2>
<p>This driver software supports both Physical Functions (PF) and Virtual Functions (VF).</p>
<p>In order to compile the Xilinx QDMA software, configured and compiled Linux kernel source tree is required.
Linux QDMA driver is dependent on <code class="docutils literal"><span class="pre">libaio</span></code>. Hence, make sure to install <code class="docutils literal"><span class="pre">libaio</span></code> before compiling the QDMA driver.
Example command is provided on Ubuntu. Follow the similar procedure for other OS flavors.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>[xilinx@]# sudo apt-get install libaio libaio-devel
</pre></div>
</div>
<p>The source tree may contain only header files, or a complete tree. The source tree needs to be configured and the header files need to be compiled.
The Linux kernel must be configured to use modules.</p>
<p>Linux QDMA Driver software can be found on the Xilinx github <a class="reference external" href="https://github.com/Xilinx/dma_ip_drivers/tree/master/QDMA/linux-kernel">https://github.com/Xilinx/dma_ip_drivers/tree/master/QDMA/linux-kernel</a>
Below is the directory structure of the Linux QDMA Driver software.</p>
<table border="1" class="docutils">
<colgroup>
<col width="30%" />
<col width="70%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head"><strong>Directory</strong></th>
<th class="head"><strong>Description</strong></th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>apps/</td>
<td>User space application to configure and control QDMA</td>
</tr>
<tr class="row-odd"><td>docs/</td>
<td>Documentation for the Xilinx QDMA Linux Driver</td>
</tr>
<tr class="row-even"><td>driver/src</td>
<td>Provides interfaces to manage the PCIe device and
exposes character driver interface to perform QDMA transfers</td>
</tr>
<tr class="row-odd"><td>driver/libqdma/</td>
<td>QDMA library to configure and control the QDMA IP</td>
</tr>
<tr class="row-even"><td>scripts/</td>
<td>Sample scripts for perform DMA operations</td>
</tr>
<tr class="row-odd"><td>Makefile</td>
<td>Makefile to compile the driver</td>
</tr>
<tr class="row-even"><td>RELEASE.txt</td>
<td>Release Notes</td>
</tr>
</tbody>
</table>
<p>Once driver sources are downloaded, compile the QDMA Driver software</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>[xilinx@]# make clean &amp;&amp; make
</pre></div>
</div>
<p>Upon executing make, A sub-directory <code class="docutils literal"><span class="pre">bin</span></code> is created with the list of executable listed in below tables.
Individual executables can also be built with commands listed against each component in below tables.</p>
<p>Optionally to enable debug mode for more detailed logs, build with the following command</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>[xilinx@]# make clean &amp; make DEBUG=1
</pre></div>
</div>
<p><strong>Kernel modules:</strong></p>
<table border="1" class="docutils">
<colgroup>
<col width="27%" />
<col width="28%" />
<col width="45%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Executable</th>
<th class="head">Description</th>
<th class="head">Command</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>qdma-pf.ko</td>
<td>PF Driver</td>
<td>make driver MODULE=mod_pf</td>
</tr>
<tr class="row-odd"><td>qdma-vf.ko</td>
<td>VF Driver</td>
<td>make driver MODULE=mod_vf</td>
</tr>
</tbody>
</table>
<p><strong>Applications:</strong></p>
<p>Run <code class="docutils literal"><span class="pre">make</span> <span class="pre">apps</span></code> to compile all the below applications.
Applications can be compiled individually as mentioned after entering the respective application directory.</p>
<table border="1" class="docutils">
<colgroup>
<col width="21%" />
<col width="55%" />
<col width="24%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Executable</th>
<th class="head">Description</th>
<th class="head">Command</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>dma-ctl</td>
<td>QDMA control and configuration application</td>
<td>make dma-ctl</td>
</tr>
<tr class="row-odd"><td>dma-to-device</td>
<td>Performs a host-to-card transaction for MM or ST</td>
<td>make dma-to-device</td>
</tr>
<tr class="row-even"><td>dma-from-device</td>
<td>Performs a card-to-host transaction for MM or ST</td>
<td>make dma-from-device</td>
</tr>
<tr class="row-odd"><td>dma-perf</td>
<td>Measures the performance of QDMA IP</td>
<td>make dma-perf</td>
</tr>
<tr class="row-even"><td>dma-latency</td>
<td>Measures the ping pong latency for ST transfers</td>
<td>make dma-latency</td>
</tr>
<tr class="row-odd"><td>dma-xfer</td>
<td>Sample transfer application</td>
<td>make dma-xfer</td>
</tr>
</tbody>
</table>
<p>Install the executable by running “make install”</p>
<ul class="simple">
<li>PF/VF kernel modules and application binaries are generated in <code class="docutils literal"><span class="pre">bin</span></code> and can be individually loaded</li>
<li><code class="docutils literal"><span class="pre">make</span> <span class="pre">install-apps</span></code> installs the applications in <code class="docutils literal"><span class="pre">/user/local/sbin</span></code>.</li>
<li><code class="docutils literal"><span class="pre">make</span> <span class="pre">install-mods</span></code> copies the <code class="docutils literal"><span class="pre">qdma-pf.ko</span></code> and <code class="docutils literal"><span class="pre">qdma-vf.ko</span></code> in <code class="docutils literal"><span class="pre">/lib/modules/&lt;kernel</span> <span class="pre">version&gt;/qdma/</span></code></li>
</ul>
<p>Ex: <code class="docutils literal"><span class="pre">/lib/modules/4.15.0-51-generic/qdma/</span></code></p>
</div>
<div class="section" id="loading-the-qdma-driver-module">
<h2>Loading the QDMA Driver Module<a class="headerlink" href="#loading-the-qdma-driver-module" title="Permalink to this headline">¶</a></h2>
<p>Before loading the QDMA driver, make sure that the target board is connected to the Host System and required bit stream is loaded on to the board.</p>
<p>Make sure to install the <code class="docutils literal"><span class="pre">qdma-pf.ko</span></code> and <code class="docutils literal"><span class="pre">qdma-vf.ko</span></code> modules using the <code class="docutils literal"><span class="pre">make</span> <span class="pre">install-mods</span></code> command.</p>
<p>For loading the driver, execute the following command:</p>
<p>PF Driver:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>modprobe qdma-pf
</pre></div>
</div>
<p>VF Driver:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>modprobe qdma-vf
</pre></div>
</div>
<p>QDMA driver supports the following list of module parameters that can be specified while loading the driver into the Linux kernel.
- Mode
- Master PF
- Dynamic config BAR</p>
<p>In order to pass the module parameters while loading a driver, a config file <code class="docutils literal"><span class="pre">qdma.conf</span></code> needs to be placed in /etc/modprobe.d directory.
The format of the conf file would be :</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>options &lt;module_name&gt; mode=&lt;bus_num&gt;:&lt;pf_num&gt;:&lt;mode&gt;,&lt;bus_num&gt;:&lt;pf_num&gt;:&lt;mode&gt;,&lt;bus_num&gt;:&lt;pf_num&gt;:&lt;mode&gt;,.....
options &lt;module_name&gt; config_bar=&lt;bus_num&gt;:&lt;pf_num&gt;:&lt;config_bar&gt;,&lt;bus_num&gt;:&lt;pf_num&gt;:&lt;config_bar&gt;,&lt;bus_num&gt;:&lt;pf_num&gt;:&lt;config_bar&gt;,.....
options &lt;module_name&gt; master_pf=&lt;bus_num&gt;:&lt;master_pf&gt;,&lt;bus_num&gt;:&lt;master_pf&gt;
</pre></div>
</div>
<ul class="simple">
<li>module_name:  Name of the mode. For PF: qdma-pf and for VF: qdma-vf</li>
<li>bus_num : Bus number of the PCIe endpoint card</li>
<li>func_num : Function number of the corressponding bus_num</li>
<li>mode: Mode in which the driver needs to be loaded</li>
<li>config_bar: Config bar number</li>
<li>master_pf: Master PF</li>
<li>num_threads: number of threads for monitoring the writeback of completions</li>
</ul>
<div class="section" id="mode">
<h3>1. <strong>Mode</strong><a class="headerlink" href="#mode" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">mode</span></code> module parameter is used to specify how the completions must be processed.
Each PF can be configured to function in following different modes</p>
<ol class="arabic" start="0">
<li><p class="first"><em>Auto Mode</em></p>
<blockquote>
<div><p>Driver polls on the status descriptor write back updates for MM and ST H2C Mode and uses Interrupt Aggregation to process the ST C2H completions.</p>
</div></blockquote>
</li>
<li><p class="first"><em>Poll Mode</em></p>
<blockquote>
<div><p>Driver polls on the status descriptor write back updates for all modes.</p>
</div></blockquote>
</li>
<li><p class="first"><em>Direct Interrupt Mode</em></p>
<blockquote>
<div><p>A single vector is assigned to each queue and status descriptor write back updates are intimated to SW driver using interrupts.</p>
</div></blockquote>
</li>
<li><p class="first"><em>Interrupt Aggregation Mode</em> or <em>Indirect Interrupt Mode</em></p>
<blockquote>
<div><p>Each function creates an Interrupt Aggregation ring and status descriptor write back updates of all the queues of the function are intimated to SW driver using interrupts into this ring.</p>
</div></blockquote>
</li>
<li><p class="first"><em>Legacy Interrupt Mode</em></p>
<blockquote>
<div><p>Driver processes the status descriptor write back using legacy interrupts</p>
</div></blockquote>
</li>
</ol>
<p>By default, the mode is set to auto mode for both of the PF and VF drivers. To set other modes, the <code class="docutils literal"><span class="pre">mode</span></code> entry needs to be added in the <code class="docutils literal"><span class="pre">qdma.conf</span></code>
file in the following format.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>options qdma-pf mode=&lt;bus_num&gt;:&lt;pf_num&gt;:&lt;mode&gt;,&lt;bus_num&gt;:&lt;pf_num&gt;:&lt;mode&gt;,&lt;bus_num&gt;:&lt;pf_num&gt;:&lt;mode&gt;,.....
options qdma-vf mode=&lt;bus_num&gt;:&lt;pf_num&gt;:&lt;mode&gt;,&lt;bus_num&gt;:&lt;pf_num&gt;:&lt;mode&gt;,&lt;bus_num&gt;:&lt;pf_num&gt;:&lt;mode&gt;,.....
</pre></div>
</div>
<p>For example, if <code class="docutils literal"><span class="pre">modprobe</span></code> command is executed with the following config file:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>options qdma-pf mode=0x06:0:2,0x06:1:3,0x06:2:0,0x07:2:1
options qdma-vf mode=0x06:0:2,0x06:1:3
</pre></div>
</div>
<ul class="simple">
<li>PF0 of bus number 6 is loaded in Direct Interrupt mode (2)</li>
<li>PF1 of bus number 6 is loaded in Indirect Interrupt mode (3)</li>
<li>PF2 of bus number 6 is loaded in Auto mode (0)</li>
<li>PF2 of bus number 7 is loaded in Poll mode (1)</li>
<li>PF0’s VF group of bus number 6 is loaded in Direct Interrupt Mode (2)</li>
<li>PF1’s VF group of bus number 6 is loaded in Indirect Interrupt Mode (3)</li>
<li>Rest all, which are not specified, are loaded in Auto mode by default.</li>
</ul>
</div>
<div class="section" id="master-pf">
<h3>2. <strong>Master PF</strong><a class="headerlink" href="#master-pf" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">master_pf</span></code> module parameter is used to set the master PF for QDMA driver
By default, <code class="docutils literal"><span class="pre">master_pf</span></code> is set to PF0(First device in the PF list)</p>
<p>To set other PF as a <code class="docutils literal"><span class="pre">master_pf</span></code>, its entry needs to be added in the <code class="docutils literal"><span class="pre">qdma.conf</span></code> file in the following format.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>options qdma-pf master_pf=&lt;bus_num&gt;:&lt;master_pf&gt;,&lt;bus_num&gt;:&lt;master_pf&gt;
</pre></div>
</div>
<p>For example, if <code class="docutils literal"><span class="pre">modprobe</span></code> command is executed with the following config file:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>options qdma-pf master_pf=0x06:0,0x07:1
</pre></div>
</div>
<ul class="simple">
<li>Master PF of bus number 6 is set as PF0</li>
<li>Master PF of bus number 7 is set as PF1</li>
</ul>
</div>
<div class="section" id="dynamic-config-bar">
<h3>3. <strong>Dynamic Config Bar</strong><a class="headerlink" href="#dynamic-config-bar" title="Permalink to this headline">¶</a></h3>
<p><code class="docutils literal"><span class="pre">config_bar</span></code> module parameter is used to set the DMA bar of the QDMA device.
QDMA IP supports changing the DMA bar while creating the bit stream.</p>
<p>For 64-bit bars, DMA bar can be 0|2|4 .
By default, the QDMA driver sets BAR0 as the DMA BAR</p>
<p>To set other config bar, the <code class="docutils literal"><span class="pre">config_bar</span></code> entry needs to be added in the <code class="docutils literal"><span class="pre">qdma.conf</span></code> file in the following format.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>options qdma-pf config_bar=&lt;bus_num&gt;:&lt;pf_num&gt;:&lt;config_bar&gt;,&lt;bus_num&gt;:&lt;pf_num&gt;:&lt;config_bar&gt;,&lt;bus_num&gt;:&lt;pf_num&gt;:&lt;config_bar&gt;,.....
options qdma-vf config_bar=&lt;bus_num&gt;:&lt;pf_num&gt;:&lt;config_bar&gt;,&lt;bus_num&gt;:&lt;pf_num&gt;:&lt;config_bar&gt;,&lt;bus_num&gt;:&lt;pf_num&gt;:&lt;config_bar&gt;,.....
</pre></div>
</div>
<p>For example, if <code class="docutils literal"><span class="pre">modprobe</span></code> command is executed with the following config file:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>options qdma-pf config_bar=0x06:0:0,0x06:1:2,0x06:2:4,0x07:2:0
options qdma-vf config_bar=0x06:0:2,0x06:1:0
</pre></div>
</div>
<ul class="simple">
<li>PF0 of bus number 6 is loaded with config bar set as 0</li>
<li>PF1 of bus number 6 is loaded with config bar set as 2</li>
<li>PF2 of bus number 6 is loaded with config bar set as 4</li>
<li>PF2 of bus number 7 is loaded with config bar set as 0</li>
<li>PF0’s VF group of bus number 6 is loaded with config bar set as 2</li>
<li>PF1’s VF group of bus number 6 is loaded with config bar set as 0</li>
<li>Rest all, which are not specified, are loaded with config bar set as 0</li>
</ul>
<p>From the examples above, a <code class="docutils literal"><span class="pre">qdma.conf</span></code> file would look like:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>options qdma-pf mode=0x06:0:2,0x06:1:3,0x06:2:0,0x07:2:1
options qdma-pf master_pf=0x06:0,0x07:1
options qdma-pf config_bar=0x06:0:0,0x06:1:2,0x06:2:4,0x07:2:0
options qdma-vf mode=0x06:0:2,0x06:1:3
options qdma-vf config_bar=0x06:0:2,0x06:1:0
</pre></div>
</div>
<p>An auxillary script, qdma_generate_conf_file.sh has been added to the scripts folder which helps create the qdma.conf
config file and copies it to the /etc/modprobe.d location. The script can be used as shown below -</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>./scripts/qdma_generate_conf_file.sh &lt;bus_num&gt; &lt;num_pfs&gt; &lt;mode&gt; &lt;config_bar&gt; &lt;master_pf&gt;
</pre></div>
</div>
<p>Please note that having the qdma-pf.ko and qdma-vf.ko files in the /lib/modules/&lt;kernel version&gt;/qdma/ will cause
automatic loading of the driver modules at boot time. To avoid this, it is recommended to have the drivers
blacklisted. This can be done by adding the below 2 lines in the /etc/modprobe.d/blacklist.conf file -</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>blacklist qdma-pf
blacklist qdma-vf
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->

</footer>

        </div>
      </div>
	  
	  
	  <!-- Sphinx Page Footer block -->
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="userguide.html" class="btn btn-neutral float-right" title="User Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="system-requirements.html" class="btn btn-neutral float-left" title="System Requirements" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on July 14, 2022.
      </span>

    </p>
  </div>	  
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
  

  
  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
														<div class="col-md-pull-6 col-lg-pull-6 col-md-6 col-lg-6">
															<span class="copyright">
                                  
                                  &copy; 2018-2022, Xilinx, Inc
                              </span>
															<ul class="list-inline sub-menu">
																<li>
																	<a href="https://www.xilinx.com/about/privacy-policy.html">Privacy</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/legal.html">Legal</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/contact.html">Contact</a>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="quicklinks parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<noindex>
						<span class="quickLinks">
							<ul>
								<li>
									<a href="#top" class="btn backToTop">
									<span class="fas fa-angle-up" aria-hidden="true"></span>
									</a>
								</li>
							</ul>
						</span>
					</noindex>
				</div>
			</div>
		</div>
		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}
			
			underscoreSetup();
		</script>
	</body>
</html>