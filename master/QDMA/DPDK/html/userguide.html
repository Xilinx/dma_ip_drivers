


<!DOCTYPE HTML>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
	<head>
		<meta charset="utf-8">
		
		<meta http-equiv="content-type" content="text/html; charset=UTF-8"/>
		<link rel="stylesheet" href="https://static.cloud.coveo.com/searchui/v2.4382/css/CoveoFullSearch.css"/>
		<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
		<meta name="description"/>
		<meta name="keywords"/>
		<meta property="og:title" content=""/>
		<meta property="og:description"/>
		<!-- favicon -->
		<link rel="icon" type="image/vnd.microsoft.icon" href="_static/favicon.ico"/>
		<link rel="shortcut icon" type="image/vnd.microsoft.icon" href="_static/favicon.ico"/>
		<!-- Fonts -->
		<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" type="text/css"/>

  
  
  
  

  
      <script type="text/javascript" src="_static/js/jquery.min.js"></script>	
	  <script type="text/javascript" src="_static/js/gtm.js"></script>
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
    <script type="text/javascript" src="_static/js/d3dd8c60ed.js"></script>
    <script type="text/javascript" src="_static/js/common-ui-all.min.js"></script>		
    <script type="text/javascript" src="_static/js/header-footer.min.js"></script>	
    <script type="text/javascript" src="_static/js/jquery-ui.min.js"></script>	
    <script type="text/javascript" src="_static/js/CoveoJsSearch.Lazy.min.js"></script>	
    <script type="text/javascript" src="_static/js/linkid.js"></script>		
    <script type="text/javascript" src="_static/js/Searchbox.min.js"></script>
  
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'./',
              VERSION:'2024.1',
              LANGUAGE:'None',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: '.txt'
          };
      </script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/common-ui-all.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/header-footer.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/pro.min.css" media="all" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Developers Guide" href="dev-guide.html" />
    <link rel="prev" title="Building QDMA DPDK Software" href="build.html" /> 
	</head>
	<body>
		<div class="xilinx-bs3"/>
		<div class="root responsivegrid">
			<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 aem-Grid--large--16 aem-Grid--xlarge--16 aem-Grid--xxlarge--16 aem-Grid--xxxlarge--16 ">
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn aem-GridColumn--default--12">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="header parbase aem-GridColumn aem-GridColumn--default--12">
								<noindex>
									<header data-component="header">
										<nav class="navbar navbar-default aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid main-nav">
													<div class="row">
														<div class="col-xs-12">
															<div class="logo-column">
																<div class="logo">
																	<a href="https://www.xilinx.com/">
																	<img src="https://www.xilinx.com/etc.clientlibs/site/clientlibs/xilinx/all/resources/imgs/header/xilinx-header-logo.svg" title="Xilinx Inc"/>
																	</a>
																</div>
															</div>
															<div class="navbar-column">
																<div class="navbar navbar-collapse collapse" id="xilinx-main-menu">
																	<div class="mobile-search-container">
																		<div id="headerSearchBox" class="headerSearch"
																			data-component="header-search" 
																			data-redirect-if-empty="false"
																			data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																			data-coveo-organization-id="xilinxcomprode2rjoqok">
																			<div class='coveo-search-section'>
																				<div class="CoveoAnalytics" data-search-hub="Site"></div>
																				<ul class="dropdown-menu options">
																					<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																						<a href="#">
																						All</a>
																					</li>
																					<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com//products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Silicon Devices</a>
																					</li>
																					<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com//products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Boards and Kits</a>
																					</li>
																					<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com//products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																						<a href="#">
																						Intellectual Property</a>
																					</li>
																					<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																						<a href="#">
																						Support</a>
																						<ul>
																							<li data-label="Documentation" data-action-link="https://www.xilinx.com//support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																								<a href="#">
																								Documentation</a>
																							</li>
																							<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com//support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																								<a href="#">
																								Knowledge Base</a>
																							</li>
																							<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																								<a href="#">
																								Community Forums</a>
																							</li>
																						</ul>
																					</li>
																					<li data-label="Partners" data-action-link="https://www.xilinx.com//alliance/member-keyword-search.html" data-search-hub="Partner">
																						<a href="#">
																						Partners</a>
																					</li>
																					<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																						<a href="#">
																						Videos</a>
																					</li>
																					<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																						<a href="#">
																						Press</a>
																					</li>
																				</ul>
																				<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																				<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																			</div>
																		</div>
																	</div>
																	<ul class="nav navbar-nav nav-justified">
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/applications.html">
																			Applications</a> 
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/products/silicon-devices.html">
																			Products</a> 
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://developer.xilinx.com/">
																			Developers</a> 
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/support.html">
																			Support</a> 
																		</li>
																		<li class="accordion-toggle-icons" data-component="toggle-dropdown">
																			<a href="https://www.xilinx.com/about/company-overview.html">
																			About</a> 
																		</li>
																	</ul>
																</div>
															</div>
															<script type="text/javascript" src="_static/js/gtm.js"></script>
															<!--<div class="mini-nav">
																<button type="button" data-function="xilinx-mobile-menu" id="nav-toggle" class="navbar-toggle collapsed visible-xs-block" aria-expanded="false">
																<span></span>
																<span></span>
																<span></span>
																<span></span>
																</button>
																<ul class="list-inline">
																	<li class="dropdown user-menu">
																		<button data-toggle="dropdown">
																		<span class="sr-only">Account</span>
																		<span class="fas fa-user"></span>
																		</button>
																		<ul class="dropdown-menu">
																			<li>
																				<a href="https://www.xilinx.com/myprofile/subscriptions.html">
																				My Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/registration/create-account.html">
																				Create Account</a>
																			</li>
																			<li>
																				<a href="https://www.xilinx.com/bin/protected/en/signout">
																				Sign Out</a>
																			</li>
																		</ul>
																	</li>
																	<li class="hidden-xs">
																		<button data-function="search-toggle">
																		<span class="sr-only">Search</span>
																		<span class="far fa-search"></span>
																		</button>
																	</li>
																</ul>
															</div>
															-->
															<div class="search-container">
																<div id="headerSearchBox" class="headerSearch"
																	data-component="header-search" 
																	data-redirect-if-empty="false"
																	data-coveo-access-token="xxa237d4dd-f0aa-47fc-9baa-af9121851b33"
																	data-coveo-organization-id="xilinxcomprode2rjoqok">
																	<div class='coveo-search-section'>
																		<div class="CoveoAnalytics" data-search-hub="Site"></div>
																		<ul class="dropdown-menu options">
																			<li class="option" data-label="All" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-search-hub="Site">
																				<a href="#">
																				All</a>
																			</li>
																			<li data-label="Silicon Devices" data-action-link="https://www.xilinx.com/products/silicon-devices/si-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Silicon Devices</a>
																			</li>
																			<li data-label="Boards and Kits" data-action-link="https://www.xilinx.com/products/boards-and-kits/bk-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Boards and Kits</a>
																			</li>
																			<li data-label="Intellectual Property" data-action-link="https://www.xilinx.com/products/intellectual-property/ip-keyword-search.html" data-search-hub="Product">
																				<a href="#">
																				Intellectual Property</a>
																			</li>
																			<li data-label="Support" class="option" data-action-link="https://www.xilinx.com/search/support-keyword-search.html" data-search-hub="Support">
																				<a href="#">
																				Support</a>
																				<ul>
																					<li data-label="Documentation" data-action-link="https://www.xilinx.com/support/documentation-navigation/documentation-keyword-search.html" data-search-hub="Document">
																						<a href="#">
																						Documentation</a>
																					</li>
																					<li data-label="Knowledge Base" data-action-link="https://www.xilinx.com/support/answer-navigation/answer-keyword-search.html" data-search-hub="AnswerRecord">
																						<a href="#">
																						Knowledge Base</a>
																					</li>
																					<li data-label="Community Forums" data-action-link="https://www.xilinx.com/search/forums-keyword-search.html" data-search-hub="Forums">
																						<a href="#">
																						Community Forums</a>
																					</li>
																				</ul>
																			</li>
																			<li data-label="Partners" data-action-link="https://www.xilinx.com/alliance/member-keyword-search.html" data-search-hub="Partner">
																				<a href="#">
																				Partners</a>
																			</li>
																			<li data-label="Videos" data-action-link="https://www.xilinx.com/video/video-keyword-search.html" data-search-hub="Video">
																				<a href="#">
																				Videos</a>
																			</li>
																			<li data-label="Press" data-action-link="https://www.xilinx.com/search/press-keyword-search.html" data-search-hub="Press">
																				<a href="#">
																				Press</a>
																			</li>
																		</ul>
																		<a href="#" class="btn dropdown-toggle value" data-toggle="dropdown"></a>
																		<div class="CoveoSearchbox" data-id="coveosearchbox" data-action-link="https://www.xilinx.com/search/site-keyword-search.html" data-placeholder="Search Xilinx"></div>
																	</div>
																</div>
																<button data-function="search-toggle">
																<span class="sr-only">Search</span>
																<span class="far fa-times"></span>
																</button>
															</div>
														</div>
													</div>
												</div>
											</div>
										</nav>
									</header>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="parsys aem-GridColumn--xxxlarge--none aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
						<div class="container-fluid">
							<div class="row">
							<div class="col-xs-12">
   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> QDMA DPDK Driver
          

          
          </a>

          
            
            
              <div class="version">
                2024.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="features.html">QDMA Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="system-requirements.html">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="build.html">Building QDMA DPDK Software</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#running-the-dpdk-software-test-application">Running the DPDK software test application</a></li>
<li class="toctree-l2"><a class="reference internal" href="#binding-pcie-functions-to-vfio">Binding PCIe functions to VFIO</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#boot-argument-changes-for-vfio">Boot argument changes for VFIO</a></li>
<li class="toctree-l3"><a class="reference internal" href="#driver-binding-with-vfio-pci">Driver binding with vfio-pci</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#controlling-and-configuring-the-qdma-ip">Controlling and Configuring the QDMA IP</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#supported-device-arguments-module-parameters">Supported Device arguments (module parameters)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#cli-support-in-qdma-testapp">CLI support in qdma_testapp</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#commands-supported-by-the-qdma-testapp-cli">Commands supported by the qdma_testapp CLI</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#virtual-machine-vm-execution-and-test">Virtual Machine (VM) execution and test</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#executing-with-vfio-pci-driver-in-vm-using-qemu">Executing with vfio-pci driver in VM using QEMU</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dev-guide.html">Developers Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="perf.html">QDMA DPDK Performance</a></li>
</ul>

            
			<p class="caption"><span class="caption-text">This Page</span></p>
				<ul class="current">
				  <li class="toctree-l1"><a href="_sources/userguide.rst.txt"
						rel="nofollow">Show Source</a></li>						
				</ul>
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">QDMA DPDK Driver</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>User Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/userguide.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="user-guide">
<h1>User Guide<a class="headerlink" href="#user-guide" title="Permalink to this headline">¶</a></h1>
<p>This section describes the details on controlling and configuring the QDMA IP</p>
<div class="section" id="running-the-dpdk-software-test-application">
<span id="run-dpdk"></span><h2>Running the DPDK software test application<a class="headerlink" href="#running-the-dpdk-software-test-application" title="Permalink to this headline">¶</a></h2>
<p>The below steps describe the step by step procedure to run the DPDK QDMA test
application and to interact with the QDMA PCIe device.</p>
<ol class="arabic simple">
<li>Navigate to examples/qdma_testapp directory.</li>
</ol>
<div class="highlight-none"><div class="highlight"><pre><span></span># cd &lt;server_dir&gt;/&lt;dpdk_test_area&gt;/dpdk-stable/examples/qdma_testapp
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Run the ‘lspci’ command on the console and verify that the PFs are detected as shown below. Here, ‘81’ is the PCIe bus number on which Xilinx QDMA device is installed.</li>
</ol>
<div class="highlight-none"><div class="highlight"><pre><span></span># lspci | grep Xilinx
81:00.0 Memory controller: Xilinx Corporation Device 903f
81:00.1 Memory controller: Xilinx Corporation Device 913f
81:00.2 Memory controller: Xilinx Corporation Device 923f
81:00.3 Memory controller: Xilinx Corporation Device 933f
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>Execute the following commands required for running the DPDK application</li>
</ol>
<div class="highlight-none"><div class="highlight"><pre><span></span># mkdir /mnt/huge
# mount -t hugetlbfs nodev /mnt/huge
# modprobe uio
# insmod ../../dpdk-kmods/linux/igb_uio/igb_uio.ko
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li>Bind PF ports to the igb_uio module as shown below</li>
</ol>
<div class="highlight-none"><div class="highlight"><pre><span></span># ../../usertools/dpdk-devbind.py -b igb_uio 81:00.0
# ../../usertools/dpdk-devbind.py -b igb_uio 81:00.1
# ../../usertools/dpdk-devbind.py -b igb_uio 81:00.2
# ../../usertools/dpdk-devbind.py -b igb_uio 81:00.3
</pre></div>
</div>
<p>5. The execution of steps 3 and 4 creates a max_vfs file entry in /sys/bus/pci/devices/0000:&lt;bus&gt;:&lt;device&gt;.&lt;function&gt;.
Enable VFs for each PF by writing the number of VFs to enable to this file as shown below.
This example creates 1 VF for each PF.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span># echo 1 &gt; /sys/bus/pci/devices/0000\:81\:00.0/max_vfs
# echo 1 &gt; /sys/bus/pci/devices/0000\:81\:00.1/max_vfs
# echo 1 &gt; /sys/bus/pci/devices/0000\:81\:00.2/max_vfs
# echo 1 &gt; /sys/bus/pci/devices/0000\:81\:00.3/max_vfs
</pre></div>
</div>
<ol class="arabic simple" start="6">
<li>Run the lspci command on the console and verify that the VFs are listed in the output as shown below</li>
</ol>
<div class="highlight-none"><div class="highlight"><pre><span></span># lspci | grep Xilinx
81:00.0 Memory controller: Xilinx Corporation Device 903f
81:00.1 Memory controller: Xilinx Corporation Device 913f
81:00.2 Memory controller: Xilinx Corporation Device 923f
81:00.3 Memory controller: Xilinx Corporation Device 933f
81:00.4 Memory controller: Xilinx Corporation Device a03f
81:08.4 Memory controller: Xilinx Corporation Device a13f
81:10.0 Memory controller: Xilinx Corporation Device a23f
81:17.4 Memory controller: Xilinx Corporation Device a33f
</pre></div>
</div>
<p>In total, 8 ports are serially arranged as shown above,
where 81:00.0 represents port 0, 81:00.1 represents port 1 and so on.
81:17.4 being the last one, represents port 7.</p>
<ol class="arabic simple" start="7">
<li>Execute the following commands to bind the VF ports to igb_uio module</li>
</ol>
<div class="highlight-none"><div class="highlight"><pre><span></span># ../../usertools/dpdk-devbind.py -b igb_uio 81:00.4
# ../../usertools/dpdk-devbind.py -b igb_uio 81:08.4
# ../../usertools/dpdk-devbind.py -b igb_uio 81:10.0
# ../../usertools/dpdk-devbind.py -b igb_uio 81:17.4
</pre></div>
</div>
<ol class="arabic simple" start="8">
<li>Run the qdma_testapp using the following command</li>
</ol>
<div class="highlight-none"><div class="highlight"><pre><span></span>#./build/qdma_testapp -c 0xf -n 4
</pre></div>
</div>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">-c</span></code> represents processor mask</li>
<li><code class="docutils literal"><span class="pre">-n</span></code> represents number of memory channels</li>
</ul>
</div>
<div class="section" id="binding-pcie-functions-to-vfio">
<h2>Binding PCIe functions to VFIO<a class="headerlink" href="#binding-pcie-functions-to-vfio" title="Permalink to this headline">¶</a></h2>
<p>Above section binds PFs and VFs with igb_uio driver. However, one can also bind to vfio-pci driver, which provides more secure and IOMMU protected access to device.</p>
<div class="section" id="boot-argument-changes-for-vfio">
<h3>Boot argument changes for VFIO<a class="headerlink" href="#boot-argument-changes-for-vfio" title="Permalink to this headline">¶</a></h3>
<p>To bind with VFIO, enable IOMMU in the grub file as below</p>
<blockquote>
<div><p>Update <code class="docutils literal"><span class="pre">/etc/default/grub</span></code> file as below.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>GRUB_CMDLINE_LINUX=&quot;default_hugepagesz=1GB hugepagesz=1G hugepages=20 iommu=on intel_iommu=on&quot;
</pre></div>
</div>
<p>Execute the following command to modify the <code class="docutils literal"><span class="pre">/boot/grub/grub.cfg</span></code> with the configuration set in the above steps and permanently add them to the kernel command line.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>update-grub
</pre></div>
</div>
<p>Reboot host system after making the above modifications.</p>
</div></blockquote>
</div>
<div class="section" id="driver-binding-with-vfio-pci">
<h3>Driver binding with vfio-pci<a class="headerlink" href="#driver-binding-with-vfio-pci" title="Permalink to this headline">¶</a></h3>
<p>For linux kernel versions prior to 5.0, vfio-pci doesn’t provide sysfs interface to enable VFs. Hence, we first bind PFs with igb_uio and enable VFs and then unbind from igb_uio to bind with vfio-pci.</p>
<p>Execute steps 1 to 6 of <a class="reference internal" href="#run-dpdk"><span class="std std-ref">Running the DPDK software test application</span></a> to bind PFs with igb_uio and enable VFs.</p>
<p>Now, unbind PFs from igb_uio driver and bind PFs and VFs to vfio-pci driver.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span># ../../usertools/dpdk-devbind.py -u 81:00.0
# ../../usertools/dpdk-devbind.py -u 81:00.1
# ../../usertools/dpdk-devbind.py -u 81:00.2
# ../../usertools/dpdk-devbind.py -u 81:00.3

# modprobe vfio-pci
# ../../usertools/dpdk-devbind.py -b vfio-pci 81:00.0
# ../../usertools/dpdk-devbind.py -b vfio-pci 81:00.1
# ../../usertools/dpdk-devbind.py -b vfio-pci 81:00.2
# ../../usertools/dpdk-devbind.py -b vfio-pci 81:00.3
# ../../usertools/dpdk-devbind.py -b vfio-pci 81:00.4
# ../../usertools/dpdk-devbind.py -b vfio-pci 81:08.4
# ../../usertools/dpdk-devbind.py -b vfio-pci 81:10.0
# ../../usertools/dpdk-devbind.py -b vfio-pci 81:17.4
</pre></div>
</div>
<p>Starting from Linux kernel version 5.7 and later, the vfio-pci module has been enhanced to fully support VFs. This includes the capability to create VFs seamlessly via the sysfs interface after binding the PF to the vfio-pci module. The following steps provide guidance on VF creation.</p>
<ol class="arabic simple">
<li>Generate the VF token by uuid command</li>
</ol>
<div class="highlight-none"><div class="highlight"><pre><span></span>14d63f20-8445-11ea-8900-1f9ce7d5650c
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Load the vfio-pci module with enable_sriov parameter set</li>
</ol>
<div class="highlight-none"><div class="highlight"><pre><span></span>sudo modprobe vfio-pci enable_sriov=1
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>Alternatively, pass the enable_sriov parameter through the sysfs if the module is already loaded or is built-in:</li>
</ol>
<div class="highlight-none"><div class="highlight"><pre><span></span>echo 1 | sudo tee /sys/module/vfio_pci/parameters/enable_sriov
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li>Bind the PCI devices to vfio-pci driver</li>
</ol>
<div class="highlight-none"><div class="highlight"><pre><span></span>../../usertools/dpdk-devbind.py -b vfio-pci 0000:81:00.0
</pre></div>
</div>
<ol class="arabic simple" start="5">
<li>Create the desired number of VF devices</li>
</ol>
<div class="highlight-none"><div class="highlight"><pre><span></span>echo 2 &gt; /sys/bus/pci/devices/0000:81:00.0/sriov_numvfs
</pre></div>
</div>
<p>Please note that between Linux kernel versions 5.0 and 5.7, there have been observed issues when unbinding PF after creating VFs using igb_uio. This process may leave SR-IOV enabled, potentially causing compatibility challenges with newer kernel versions that incorporate vfio-pci as a built-in module. To mitigate this concern, we recommend considering an upgrade to kernel version 5.7 or a more recent release, as these versions have addressed these issues and offer improved compatibility.</p>
</div>
</div>
<div class="section" id="controlling-and-configuring-the-qdma-ip">
<h2>Controlling and Configuring the QDMA IP<a class="headerlink" href="#controlling-and-configuring-the-qdma-ip" title="Permalink to this headline">¶</a></h2>
<div class="section" id="supported-device-arguments-module-parameters">
<h3>Supported Device arguments (module parameters)<a class="headerlink" href="#supported-device-arguments-module-parameters" title="Permalink to this headline">¶</a></h3>
<p>Device specific parameters can be passed to a device by using the ‘-a’ EAL option.
Xilinx supports following device arguments to configure PCIe device.</p>
<ol class="arabic">
<li><p class="first"><strong>config_bar</strong></p>
<blockquote>
<div><p>This parameter specifies the PCIe BAR number where QDMA configuration register space is mapped.
Valid values are 0 to 5. Default is set to 0 i.e. BAR 0 in the driver.</p>
<p>Example usage:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>./build/qdma_testapp -c 0x1f -n 4 -a 81:00.0,config_bar=2 -a 81:00.1,config_bar=4
</pre></div>
</div>
<p>This example configures BAR 2 as QDMA configuration BAR for device “81:00.0”
and BAR 4 as QDMA configuration BAR for device “81:00.1”.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>desc_prefetch</strong></p>
<blockquote>
<div><p>This parameter enables or disables descriptor prefetch on C2H streaming queues.
Default is prefetch disabled.</p>
<p>Example usage:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>./build/qdma_testapp -c 0x1f -n 4 -a 81:00.0,desc_prefetch=1
</pre></div>
</div>
<p>This example enables descriptor prefetch on all the streaming C2H queues of
the device “81:00.0”.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>cmpt_desc_len</strong></p>
<blockquote>
<div><p>This parameter sets the completion entry length of the completion queue.
Valid lengths are 8, 16, 32 and 64 bytes. Default length is 8 bytes.</p>
<p>Example usage:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>./build/qdma_testapp -c 0x1f -n 4 -a 81:00.0,cmpt_desc_len=32
</pre></div>
</div>
<p>This example sets completion entry length to 32 bytes on all the completion queues
of the device “81:00.0”.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>trigger_mode</strong></p>
<blockquote>
<div><p>This parameter sets the trigger mode for completion. Possible values for trigger_mode are:</p>
<p>0 - DISABLE</p>
<p>1 – Trigger on EVERY event</p>
<p>2 – Trigger when USER_COUNT threshold is reached</p>
<p>3 – Trigger when USER defined event is reached</p>
<p>4 - Trigger when USER_TIMER threshold is reached</p>
<p>5 - Trigger when either of USER_TIMER or COUNT is reached.</p>
<p>Default value configured in the driver is 4.</p>
<p>Example usage:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>./build/qdma_testapp -c 0x1f -n 4 -a 81:00.0,trigger_mode=1
</pre></div>
</div>
<p>This example sets the trigger mode to every event for all the
completion queues of the device “81:00.0”.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>c2h_byp_mode</strong></p>
<blockquote>
<div><p>This parameter sets the C2H stream mode. Valid values are</p>
<p>0 - Bypass disabled</p>
<p>1 - Cache bypass mode</p>
<p>2 - Simple bypass mode</p>
<p>Default is internal mode i.e. bypass disabled.</p>
<p>Example usage:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>./build/qdma_testapp -c 0x1f -n 4 -a 81:00.0,c2h_byp_mode=2
</pre></div>
</div>
<p>This example sets simple bypass mode on all the C2H queues belonging to the
PCIe device “81:00.0”.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>h2c_byp_mode</strong></p>
<blockquote>
<div><p>This parameter sets the H2C bypass mode. Valid values are</p>
<p>0 - Bypass disabled</p>
<p>1 - Bypass enabled</p>
<p>Default is Bypass disabled.</p>
<p>Example usage:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>./build/qdma_testapp -c 0x1f -n 4 -a 81:00.0,h2c_byp_mode=1
</pre></div>
</div>
<p>This example sets bypass mode on all the H2C queues belonging to the
PCIe device “81:00.0”.</p>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="cli-support-in-qdma-testapp">
<h3>CLI support in qdma_testapp<a class="headerlink" href="#cli-support-in-qdma-testapp" title="Permalink to this headline">¶</a></h3>
<p>Sample log of the qdma_testapp execution is given below.
After running the qdma_testapp, command line prompt appears on the console as shown below.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>#./build/qdma_testapp -c 0xf -n 4
QDMA testapp rte eal init...
EAL: Detected 8 lcore(s)
EAL: Probing VFIO support...
EAL: PCI device 0000:81:00.0 on NUMA socket -1
EAL: probe driver: 10ee:903f net_qdma
EAL: PCI device 0000:81:00.1 on NUMA socket -1
EAL: probe driver: 10ee:913f net_qdma
EAL: PCI device 0000:81:00.2 on NUMA socket -1
EAL: probe driver: 10ee:923f net_qdma
EAL: PCI device 0000:81:00.3 on NUMA socket -1
EAL: probe driver: 10ee:933f net_qdma
EAL: PCI device 0000:81:00.4 on NUMA socket -1
EAL: probe driver: 10ee:a03f net_qdma
EAL: PCI device 0000:81:08.4 on NUMA socket -1
EAL: probe driver: 10ee:a13f net_qdma
EAL: PCI device 0000:81:10.0 on NUMA socket -1
EAL: probe driver: 10ee:a23f net_qdma
EAL: PCI device 0000:81:17.4 on NUMA socket -1
EAL: probe driver: 10ee:a33f net_qdma
Ethernet Device Count: 8
Logical Core Count: 4
xilinx-app&gt;
</pre></div>
</div>
<div class="section" id="commands-supported-by-the-qdma-testapp-cli">
<h4>Commands supported by the qdma_testapp CLI<a class="headerlink" href="#commands-supported-by-the-qdma-testapp-cli" title="Permalink to this headline">¶</a></h4>
<ol class="arabic">
<li><p class="first"><strong>port_init</strong></p>
<blockquote>
<div><p>This command assigns queues to the port, sets up required resources for the queues, and prepares queues for data processing.
Format for this commad is:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>port_init &lt;port-id&gt; &lt;num-queues&gt; &lt;num-st-queues&gt; &lt;ring-depth&gt; &lt;pkt-buff-size&gt;
</pre></div>
</div>
<p><strong>port-id</strong> represents a logical numbering for PCIe functions in the order they are bind to <code class="docutils literal"><span class="pre">igb_uio</span></code> driver.
The first PCIe function that is bound has port id as 0.</p>
<p><strong>num-queues</strong> represents the total number of queues to be assigned to the port</p>
<p><strong>num-st-queues</strong> represents the total number of queues to be configured in streaming mode.
This implies that the (num-queues - num-st-queues) number of queues has to be configured in memory mapped mode.</p>
<p><strong>ring-depth</strong> represents the number of entries in C2H and H2C descriptor rings of each queue of the port</p>
<p><strong>pkt-buff-size</strong> represents the size of the data that a single C2H or H2C descriptor can support</p>
<p>Example usage:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>port_init 1 32 16 1024 4096
</pre></div>
</div>
<p>This example initializes Port 1 with first 16 queues in streaming mode and remaining 16 queues in memory mapped mode.
Number of C2H and H2C descriptor ring depth is set to 1024 and data buffer of 4KB supported by each descriptor.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>port_close</strong></p>
<blockquote>
<div><p>This command frees up all the allocated resources and removes the queues associated with the port.
Format for this commad is:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>port_close &lt;port-id&gt;
</pre></div>
</div>
<p><strong>port-id</strong> represents a logical numbering for PCIe functions in the order they are bind to <code class="docutils literal"><span class="pre">igb_uio</span></code> driver.
The first PCIe function that is bound has port id as 0.</p>
<p>Example usage:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>port_close 0
</pre></div>
</div>
<p>This example closes the port 0. Port 0 can again be re-initialized with <cite>port_init</cite> command after <cite>port_close</cite> command.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>port_reset</strong></p>
<blockquote>
<div><p>This command resets the DPDK port. This command is supported for VF port only.
This command closes the port and re-initializes it with the values provided in this command.
Format for this commad is:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>port_reset &lt;port-id&gt; &lt;num-queues&gt; &lt;num-st-queues&gt; &lt;ring-depth&gt; &lt;pkt-buff-size&gt;
</pre></div>
</div>
<p><strong>port-id</strong> represents a logical numbering for PCIe functions in the order they are bind to <code class="docutils literal"><span class="pre">igb_uio</span></code> driver.
The first PCIe function that is bound has port id as 0.</p>
<p><strong>num-queues</strong> represents the total number of queues to be assigned to the port</p>
<p><strong>num-st-queues</strong> represents the total number of queues to be configured in streaming mode.
This implies that the (num-queues - num-st-queues) number of queues has to be configured in memory mapped mode.</p>
<p><strong>ring-depth</strong> represents the number of entries in C2H and H2C descriptor rings of each queue of the port</p>
<p><strong>pkt-buff-size</strong> represents the size of the data that a single C2H or H2C descriptor can support</p>
<p>Example usage:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>port_reset 4 32 16 1024 4096
</pre></div>
</div>
<p>This example command resets the port 4 and re-initializes it with first 16 queues in streaming mode and
remaining 16 queues in memory mapped mode. Number of C2H and H2C descriptor ring depth is set to 1024
and data buffer of 4KB supported by each descriptor.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>port_remove</strong></p>
<blockquote>
<div><p>This command frees up all the resources allocated for the port and removes the port from application use.
User will need to restart the application to use the port again.
Format for this commad is:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>port_remove &lt;port-id&gt;
</pre></div>
</div>
<p><strong>port-id</strong> represents a logical numbering for PCIe functions in the order they are bind to <code class="docutils literal"><span class="pre">igb_uio</span></code> driver.
The first PCIe function that is bound has port id as 0.</p>
<p>Example usage:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>port_remove 4
</pre></div>
</div>
<p>This example removes the port 4. Restart the application to use port 4 again.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>dma_to_device</strong></p>
<blockquote>
<div><p>This command is used to DMA the data from host to card.
Format for this commad is:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>dma_to_device &lt;port-id&gt; &lt;num-queues&gt; &lt;input-filename&gt; &lt;dst-addr&gt; &lt;size&gt; &lt;iterations&gt;
</pre></div>
</div>
<p><strong>port-id</strong> represents a logical numbering for PCIe functions in the order they are bind to <code class="docutils literal"><span class="pre">igb_uio</span></code> driver.
The first PCIe function that is bound has port id as 0.</p>
<p><strong>num-queues</strong> represents the total number of queues to use for transmitting the data</p>
<p><strong>input-filename</strong> represents the path to a valid binary data file, contents of which needs to be DMA’ed</p>
<p><strong>dst-addr</strong> represents the destination address (offset) in the card to where DMA should be done in memory mapped mode.
This field is ignored for streaming mode queues.</p>
<p><strong>size</strong> represents the amount of data in bytes that needs to be transmitted to the card from the given input file.
Data will be segmented across queues such that the total data transferred to the card is <cite>size</cite> amount</p>
<p><strong>iterations</strong> represents the number of loops to repeat the same DMA transfer</p>
<p>Example usage:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>dma_to_device 0 2048 mm_datafile_1MB.bin 0 524288 0
</pre></div>
</div>
<p>This example segments the (524288) bytes from the mm_datafile_1MB.bin file equally to 2048 queues
and transmits the segmented data on each queue starting at destination BRAM offset 0 for 1st queue,
offset (1*524288)/2048 for 2nd queue, and so on.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>dma_from_device</strong></p>
<blockquote>
<div><p>This command is used to DMA the data from card to host.
Format for this commad is:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>dma_from_device &lt;port-id&gt; &lt;num-queues&gt; &lt;output-filename&gt; &lt;src-addr&gt; &lt;size&gt; &lt;iterations&gt;
</pre></div>
</div>
<p><strong>port-id</strong> represents a logical numbering for PCIe functions in the order they are bind to <code class="docutils literal"><span class="pre">igb_uio</span></code> driver.
The first PCIe function that is bound has port id as 0.</p>
<p><strong>num-queues</strong> represents the total number of queues to use to receive the data</p>
<p><strong>output-filename</strong> represents the path to output file to dump the received data</p>
<p><strong>src-addr</strong> represents the source address (offset) in the card from where DMA should be done in memory mapped mode.
This field is ignored for streaming mode queues.</p>
<p><strong>size</strong> represents the amount of data in bytes that needs to be received from the card.
Data will be segmented across queues such that the total data transferred from the card is <cite>size</cite> amount</p>
<p><strong>iterations</strong> represents the number of loops to repeat the same DMA transfer</p>
<p>Example usage:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>dma_from_device 0 2048 port0_qcount2048_size524288.bin 0 524288 0
</pre></div>
</div>
<p>This example receives 524288 bytes from 2048 queues and writes to port0_qcount2048_size524288.bin file.
1st queue receives (524288/2048) bytes of data from BRAM offset 0,
2nd queue receives (524288/2048) bytes of data from BRAM offset (1*524288)/2048, and so on.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>reg_read</strong></p>
<blockquote>
<div><p>This command is used to read the specified register.
Format for this commad is:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>reg_read &lt;port-id&gt; &lt;bar-num&gt; &lt;address&gt;
</pre></div>
</div>
<p><strong>port-id</strong> represents a logical numbering for PCIe functions in the order they are bind to <code class="docutils literal"><span class="pre">igb_uio</span></code> driver.
The first PCIe function that is bound has port id as 0.</p>
<p><strong>bar-num</strong> represents the PCIe BAR where the register is located and this input value should be a decimal value in the range 0-5</p>
<p><strong>address</strong> represents offset of the register in the PCIe BAR <cite>bar-num</cite></p>
</div></blockquote>
</li>
<li><p class="first"><strong>reg_write</strong></p>
<blockquote>
<div><p>This command is used to write a 32-bit value to the specified register.
Format for this commad is:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>reg_write &lt;port-id&gt; &lt;bar-num&gt; &lt;address&gt; &lt;value&gt;
</pre></div>
</div>
<p><strong>port-id</strong> represents a logical numbering for PCIe functions in the order they are bind to <code class="docutils literal"><span class="pre">igb_uio</span></code> driver.
The first PCIe function that is bound has port id as 0.</p>
<p><strong>bar-num</strong> represents the PCIe BAR where the register is located and this input value should be a decimal value in the range 0-5</p>
<p><strong>address</strong> represents offset of the register in the PCIe BAR <cite>bar-num</cite></p>
<p><strong>value</strong> represents the value to be written at the register offset <cite>address</cite></p>
</div></blockquote>
</li>
<li><p class="first"><strong>reg_dump</strong></p>
<blockquote>
<div><p>This command dumps important QDMA registers values of the given port on console.
Format for this commad is:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>reg_dump &lt;port-id&gt;
</pre></div>
</div>
<p><strong>port-id</strong> represents a logical numbering for PCIe functions in the order they are bind to <code class="docutils literal"><span class="pre">igb_uio</span></code> driver.
The first PCIe function that is bound has port id as 0.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>reg_info_read</strong></p>
<blockquote>
<div><p>This command reads the field info for the specified number of registers of the given port on console.
Format for this commad is:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>reg_info_read &lt;port-id&gt; &lt;reg-addr&gt; &lt;num-regs&gt;
</pre></div>
</div>
<p><strong>port-id</strong> represents a logical numbering for PCIe functions in the order they are bind to <code class="docutils literal"><span class="pre">igb_uio</span></code> driver.
The first PCIe function that is bound has port id as 0.</p>
<p><strong>reg-addr</strong> represents offset of the register in the PCIe BAR <cite>bar-num</cite></p>
<p><strong>rum-regs</strong> represents number of registers to read</p>
</div></blockquote>
</li>
<li><p class="first"><strong>queue_dump</strong></p>
<blockquote>
<div><p>This command dumps the queue context of the specified queue number of the given port.
Format for this commad is:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>queue_dump &lt;port-id&gt; &lt;queue-id&gt;
</pre></div>
</div>
<p><strong>port-id</strong> represents a logical numbering for PCIe functions in the order they are bind to <code class="docutils literal"><span class="pre">igb_uio</span></code> driver.
The first PCIe function that is bound has port id as 0.</p>
<p><strong>queue-id</strong> represents the queue number relative to the port, whose context information needs to be logged</p>
</div></blockquote>
</li>
<li><p class="first"><strong>desc_dump</strong></p>
<blockquote>
<div><p>This command dumps the descriptors of the C2H and H2C rings of the specified queue number of the given port.
Format for this commad is:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>desc_dump &lt;port-id&gt; &lt;queue-id&gt;
</pre></div>
</div>
<p><strong>port-id</strong> represents a logical numbering for PCIe functions in the order they are bind to <code class="docutils literal"><span class="pre">igb_uio</span></code> driver.
The first PCIe function that is bound has port id as 0.</p>
<p><strong>queue-id</strong> represents the queue number relative to the port, whose C2H and H2C ring descriptors needs to be dumped</p>
</div></blockquote>
</li>
<li><p class="first"><strong>load_cmds</strong></p>
<blockquote>
<div><p>This command executes the list of CLI commands from the given file.
Format for this commad is:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>load_cmds &lt;file_name&gt;
</pre></div>
</div>
<p><strong>file_name</strong> represents path to a valid file containing list of above described CLI commands to be executed in sequence.</p>
</div></blockquote>
</li>
<li><p class="first"><strong>help</strong></p>
<blockquote>
<div><p>This command dumps the help menu with supported commands and their format.
Format for this commad is:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>help
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first"><strong>ctrl+d</strong></p>
<blockquote>
<div><p>The keyboard keys <code class="docutils literal"><span class="pre">Ctrl</span></code> and <code class="docutils literal"><span class="pre">D</span></code> when pressed together quits the application.</p>
</div></blockquote>
</li>
</ol>
</div>
</div>
</div>
<div class="section" id="virtual-machine-vm-execution-and-test">
<h2>Virtual Machine (VM) execution and test<a class="headerlink" href="#virtual-machine-vm-execution-and-test" title="Permalink to this headline">¶</a></h2>
<p>Assuming that the VM image has been created with the settings outlined in Table <a class="reference internal" href="system-requirements.html#guest-system-cfg"><span class="std std-ref">Guest System Configuration</span></a>, follow below steps to execute qdma_testapp on VM.</p>
<ol class="arabic">
<li><p class="first">On host system, update <code class="docutils literal"><span class="pre">/etc/default/grub</span></code> file as below to enable IOMMU.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>GRUB_CMDLINE_LINUX=&quot;default_hugepagesz=1GB hugepagesz=1G hugepages=20 iommu=on intel_iommu=pt&quot;
</pre></div>
</div>
<p>Execute the following command to modify the <code class="docutils literal"><span class="pre">/boot/grub/grub.cfg</span></code> with the configuration set in the above step and permanently add them to the kernel command line.</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>update-grub
</pre></div>
</div>
<p>Reboot host system after making the above modifications.</p>
</li>
<li><p class="first">On the host system, insert igb_uio driver and bind the PFs with the igb_uio driver</p>
</li>
<li><p class="first">Enable VF(s) on host system by writing the number of VF(s) to enable in <code class="docutils literal"><span class="pre">max_vfs</span></code> file under <code class="docutils literal"><span class="pre">/sys/bus/pci/devices/0000:&lt;bus&gt;:&lt;device&gt;.&lt;function&gt;</span></code>.</p>
<blockquote>
<div><div class="highlight-none"><div class="highlight"><pre><span></span># echo 1 &gt; /sys/bus/pci/devices/0000\:81\:00.0/max_vfs
</pre></div>
</div>
<p><code class="docutils literal"><span class="pre">lspci</span></code> should now show new entry for VF</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>81:00.4 Memory controller: Xilinx Corporation Device a03f
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Start qdma_testapp application on host system</p>
</li>
<li><p class="first">Start the VM using below command by attaching the VF (81:00.4 in this example)</p>
<blockquote>
<div><div class="highlight-none"><div class="highlight"><pre><span></span>qemu-system-x86_64 -cpu host -enable-kvm -m 15360 -smp sockets=1,cores=10 -hda &lt;vm_image.qcow2&gt;
-device e1000,netdev=net0 -netdev user,id=net0,hostfwd=tcp::5556-:22 -device vfio-pci,host=81:00.4 -vnc :5556 &amp;
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Copy the DPDK source code in VM by executing below command from VM.</p>
<blockquote>
<div><div class="highlight-none"><div class="highlight"><pre><span></span>scp -r &lt;username&gt;@&lt;host_ip&gt;:&lt;dpdk_sources&gt; &lt;dpdk_copy_path_in_vm&gt;
</pre></div>
</div>
</div></blockquote>
</li>
<li><p class="first">Once the VM is launched, execute steps as outlined in section <a class="reference internal" href="build.html#build-dpdk"><span class="std std-ref">Building QDMA DPDK Software</span></a> to build DPDK on VM</p>
</li>
<li><p class="first">Bind the VF device in VM to igb_uio driver and execute qdma_testapp in VM as outlined in section <a class="reference internal" href="#run-dpdk"><span class="std std-ref">Running the DPDK software test application</span></a>.</p>
</li>
</ol>
<div class="section" id="executing-with-vfio-pci-driver-in-vm-using-qemu">
<h3>Executing with vfio-pci driver in VM using QEMU<a class="headerlink" href="#executing-with-vfio-pci-driver-in-vm-using-qemu" title="Permalink to this headline">¶</a></h3>
<p>Follow below steps on Host side before attaching VFs to QEMU.</p>
<p>1. Find the Vendor Id (e.g. 10ee) and Device Id (e.g. a03f, a13f) of the VFs being attached to VM using <code class="docutils literal"><span class="pre">lspci</span></code> command.
Add the Vendor Id and Device Id to vfio-pci and bind the VFs to vfio-pci as below</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>echo &quot;10ee a03f&quot; &gt; /sys/bus/pci/drivers/vfio-pci/new_id
echo 0000:81:00.4 &gt; /sys/bus/pci/devices/0000:81:00.4/driver/unbind
echo 0000:81:00.4 &gt; /sys/bus/pci/drivers/vfio-pci/bind

echo &quot;10ee a13f&quot; &gt; /sys/bus/pci/drivers/vfio-pci/new_id
echo 0000:81:08.4 &gt; /sys/bus/pci/devices/0000:81:08.4/driver/unbind
echo 0000:81:08.4 &gt; /sys/bus/pci/drivers/vfio-pci/bind
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li>Attach the VFs (here, 81:00.4 and 81:08.4) to VM via vfio-pci using QEMU with below command.</li>
</ol>
<div class="highlight-none"><div class="highlight"><pre><span></span>qemu-system-x86_64 -cpu host -enable-kvm -m 15360 -smp sockets=1,cores=10 -hda &lt;vm_image.qcow2&gt;
-device e1000,netdev=net0 -netdev user,id=net0,hostfwd=tcp::5556-:22 -device vfio-pci,host=81:00.4, -device vfio-pci,host=81:08.4 -vnc :5556 &amp;
</pre></div>
</div>
<p><strong>Notes</strong>:</p>
<blockquote>
<div><ol class="arabic simple">
<li>If Qemu fails to  launch VM with the above command, with “VF token required for access” error, Update Qemu to version 8.2.4. This version supports passing vf-token to VM.
Run below steps to register VF token.</li>
<li>VF token can be passed to DPDK by using EAL parameter - -vfio-vf-token. Run below command to pass vf-token across all PF and VF ports.(Use the uuid generated earlier
as outlined under “Driver binding with vfio-pci” section)</li>
</ol>
<div class="highlight-none"><div class="highlight"><pre><span></span>./build/qdma_testapp -c 0xf --vfio-vf-token=&lt;uuid&gt; -n 4
</pre></div>
</div>
<p>After running the above command, exit from the application as VFs need to be attached to VM. vf-token should be same for PF’s and VF’s.</p>
<ol class="arabic simple" start="3">
<li>Now launch VM using following command with vf-token parameter</li>
</ol>
<div class="highlight-none"><div class="highlight"><pre><span></span>qemu-system-x86_64 -cpu host -enable-kvm -m 15360 -smp sockets=1,cores=10 -hda &lt;vm_image.qcow2&gt; -device e1000,netdev=net0 -netdev user,id=net0,hostfwd=tcp::5556-:22
-device vfio-pci,host=0000:81:00.4,vf-token=&lt;uuid&gt;, -device vfio-pci,host=0000:81:08.4,vf-token=&lt;uuid&gt; -vnc :5556 &amp;
</pre></div>
</div>
<p>Before running any dpdk application in VM, ensure to run qdma_testapp on host system with vf-token as shown in step 2, to handle mailbox events.</p>
</div></blockquote>
<p>Follow below steps inside VM to bind the functions with vfio-pci</p>
<ol class="arabic simple">
<li>Once the VM is launched, execute steps as outlined in section <a class="reference internal" href="build.html#build-dpdk"><span class="std std-ref">Building QDMA DPDK Software</span></a> to build DPDK on VM</li>
<li>Enable <code class="docutils literal"><span class="pre">noiommu</span></code> mode to support vfio-pci driver in VM as there won’t be physical IOMMU device present inside VM</li>
</ol>
<div class="highlight-none"><div class="highlight"><pre><span></span>modprobe vfio-pci
echo 1 &gt; /sys/module/vfio/parameters/enable_unsafe_noiommu_mode
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li>Bind the VF device in VM to vfio-pci driver and execute qdma_testapp in VM as outlined in section <a class="reference internal" href="#run-dpdk"><span class="std std-ref">Running the DPDK software test application</span></a>.</li>
</ol>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
<!-- Atalwar: Moved the footer code to layout.html to resolve conflict with the Xilinx template -->

</footer>

        </div>
      </div>
	  
	  
	  <!-- Sphinx Page Footer block -->
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="dev-guide.html" class="btn btn-neutral float-right" title="Developers Guide" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="build.html" class="btn btn-neutral float-left" title="Building QDMA DPDK Software" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo" class="copyright">
    <p class="footerinfo">
      <span class="lastupdated">
        Last updated on January 01, 2025.
      </span>

    </p>
  </div>	  
      </div>
    </section>


  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
  
  

  
  <!--  Xilinx template footer block -->
							</div>
						</div>
					</div>
				</div>
				<div class="xilinxExperienceFragments experiencefragment aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<div class="xf-content-height">
						<div class="aem-Grid aem-Grid--16 aem-Grid--default--16 ">
							<div class="footer parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
								<noindex>
									<footer>
										<div class="aem-Grid aem-Grid--16">
											<div class="aem-GridColumn aem-GridColumn--xxxlarge--none aem-GridColumn--xsmall--16 aem-GridColumn--offset--xsmall--0 aem-GridColumn--xlarge--none aem-GridColumn--xxlarge--none aem-GridColumn--default--none aem-GridColumn--offset--large--1 aem-GridColumn--xlarge--12 aem-GridColumn--offset--default--0 aem-GridColumn--xxlarge--10 aem-GridColumn--offset--xlarge--2 aem-GridColumn--offset--xxlarge--3 aem-GridColumn--offset--xxxlarge--4 aem-GridColumn--xsmall--none aem-GridColumn--large--none aem-GridColumn aem-GridColumn--large--14 aem-GridColumn--xxxlarge--8 aem-GridColumn--default--16">
												<div class="container-fluid sub-footer">
													<div class="row">
														<div class="footerSocial parbase">
															<div class="col-md-push-6 col-lg-push-6 col-md-6 col-lg-6">
																<ul class="list-inline pull-right social-menu">
																	<li>
																		<a href="https://www.linkedin.com/company/xilinx">
																		<span class="linkedin icon"></span>
																		<span class="sr-only">Connect on LinkedIn</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.twitter.com/XilinxInc">
																		<span class="twitter icon"></span>
																		<span class="sr-only">Follow us on Twitter</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.facebook.com/XilinxInc">
																		<span class="facebook icon"></span>
																		<span class="sr-only">Connect on Facebook</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.youtube.com/XilinxInc">
																		<span class="youtube icon"></span>
																		<span class="sr-only">Watch us on YouTube</span>
																		</a>
																	</li>
																	<li>
																		<a href="https://www.xilinx.com/registration/subscriber-signup.html">
																		<span class="newsletter icon"></span>
																		<span class="sr-only">Subscribe to Newsletter</span>
																		</a>
																	</li>
																</ul>
															</div>
														</div>
														<div class="col-md-pull-6 col-lg-pull-6 col-md-6 col-lg-6">
															<span class="copyright">
                                  
                                  &copy; 2022-2024 Advanced Micro Devices Inc.
                              </span>
															<ul class="list-inline sub-menu">
																<li>
																	<a href="https://www.xilinx.com/about/privacy-policy.html">Privacy</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/legal.html">Legal</a>
																</li>
																<li>
																	<a href="https://www.xilinx.com/about/contact.html">Contact</a>
																</li>
															</ul>
														</div>
													</div>
												</div>
											</div>
										</div>
									</footer>
								</noindex>
							</div>
						</div>
					</div>
				</div>
				<div class="quicklinks parbase aem-GridColumn--default--none aem-GridColumn aem-GridColumn--offset--default--0 aem-GridColumn--default--16">
					<noindex>
						<span class="quickLinks">
							<ul>
								<li>
									<a href="#top" class="btn backToTop">
									<span class="fas fa-angle-up" aria-hidden="true"></span>
									</a>
								</li>
							</ul>
						</span>
					</noindex>
				</div>
			</div>
		</div>
		<script>window.CQ = window.CQ || {}</script>
		<script src="https://static.cloud.coveo.com/searchui/v2.4382/js/CoveoJsSearch.Lazy.min.js"></script>
		<script>
			var underscoreSetup = function () {
			  _.templateSettings.interpolate = /\{\{=([^-][\S\s]+?)\}\}/g;
			  _.templateSettings.evaluate = /\{\{([^-=][\S\s]+?)\}\}/g;
			  _.templateSettings.escape = /\{\{-([^=][\S\s]+?)\}\}/g;
			}
			
			underscoreSetup();
		</script>
	</body>
</html>